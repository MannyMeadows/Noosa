!function(){THREE.GLTFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.parser=l},THREE.GLTFLoader.prototype={constructor:THREE.GLTFLoader,load:function(e,t,r,i){var n=this,s=this.path&&"string"==typeof this.path?this.path:THREE.Loader.prototype.extractUrlBase(e),a=new THREE.XHRLoader(n.manager);a.load(e,function(e){n.parse(JSON.parse(e),t,s)},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e},parse:function(e,t,r){console.time("GLTFLoader");var i=new this.parser(e,{path:r||this.path,crossOrigin:!!this.crossOrigin});return i.parse(function(e,r,i){console.timeEnd("GLTFLoader");var n={scene:e,cameras:r,animations:i};t(n)}),{get scene(){return console.warn("Synchronous glTF object access is deprecated. Use the asynchronous 'callback' argument instead."),scene},set scene(e){console.warn("Synchronous glTF object access is deprecated. Use the asynchronous 'callback' argument instead."),scene=e}}}};var e=function(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}},update:function(t,r){h(e,function(e){e.update&&e.update(t,r)})}}};THREE.GLTFLoader.Shaders=new e;var t=function(e,t){this.boundUniforms={},h(e.material.uniforms,function(r,i){if(r.semantic){var n=r.node,s=e;n&&(s=t[n]),this.boundUniforms[i]={semantic:r.semantic,sourceNode:s,targetNode:e,uniform:r}}}.bind(this)),this._m4=new THREE.Matrix4};t.prototype.update=function(e,t){e.updateMatrixWorld(),t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),h(this.boundUniforms,function(e){switch(e.semantic){case"MODELVIEW":var r=e.uniform.value;r.multiplyMatrices(t.matrixWorldInverse,e.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var i=e.uniform.value;this._m4.multiplyMatrices(t.matrixWorldInverse,e.sourceNode.matrixWorld),i.getNormalMatrix(this._m4);break;case"PROJECTION":var r=e.uniform.value;r.copy(t.projectionMatrix);break;case"JOINTMATRIX":for(var n=e.uniform.value,s=0;s<n.length;s++)n[s].getInverse(e.sourceNode.matrixWorld).multiply(e.targetNode.skeleton.bones[s].matrixWorld).multiply(e.targetNode.skeleton.boneInverses[s]);break;default:console.warn("Unhandled shader semantic: "+e.semantic)}}.bind(this))},THREE.GLTFLoader.Animations=new e;var r=function(e){this.running=!1,this.loop=!1,this.duration=0,this.startTime=0,this.interps=[],this.uuid=THREE.Math.generateUUID(),e&&this.createInterpolators(e)};r.prototype.createInterpolators=function(e){for(var t=0,r=e.length;t<r;t++){var n=new i(e[t]);this.interps.push(n),this.duration=Math.max(this.duration,n.duration)}},r.prototype.play=function(){this.running||(this.startTime=Date.now(),this.running=!0,THREE.GLTFLoader.Animations.add(this.uuid,this))},r.prototype.stop=function(){this.running=!1,THREE.GLTFLoader.Animations.remove(this.uuid)},r.prototype.update=function(){if(this.running){var e=Date.now(),t=(e-this.startTime)/1e3,r=t%this.duration,i=Math.floor(t/this.duration);return i>=1&&!this.loop?(this.running=!1,h(this.interps,function(e,t){this.interps[t].interp(this.duration)}.bind(this)),void this.stop()):void h(this.interps,function(e,t){this.interps[t].interp(r)}.bind(this))}};var i=function(e){this.keys=e.keys,this.values=e.values,this.count=e.count,this.type=e.type,this.path=e.path,this.isRot=!1;var t=e.target;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,this.targetNode=t,e.path){case"translation":this.target=t.position,this.originalValue=t.position.clone();break;case"rotation":this.target=t.quaternion,this.originalValue=t.quaternion.clone(),this.isRot=!0;break;case"scale":this.target=t.scale,this.originalValue=t.scale.clone()}this.duration=this.keys[this.count-1],this.vec1=new THREE.Vector3,this.vec2=new THREE.Vector3,this.vec3=new THREE.Vector3,this.quat1=new THREE.Quaternion,this.quat2=new THREE.Quaternion,this.quat3=new THREE.Quaternion};i.prototype.interp=function(e){if(e==this.keys[0])this.isRot?this.quat3.fromArray(this.values):this.vec3.fromArray(this.values);else if(e<this.keys[0])this.isRot?(this.quat1.copy(this.originalValue),this.quat2.fromArray(this.values),THREE.Quaternion.slerp(this.quat1,this.quat2,this.quat3,e/this.keys[0])):(this.vec3.copy(this.originalValue),this.vec2.fromArray(this.values),this.vec3.lerp(this.vec2,e/this.keys[0]));else if(e>=this.keys[this.count-1])this.isRot?this.quat3.fromArray(this.values,4*(this.count-1)):this.vec3.fromArray(this.values,3*(this.count-1));else for(var t=0;t<this.count-1;t++){var r=this.keys[t],i=this.keys[t+1];e>=r&&e<=i&&(this.isRot?(this.quat1.fromArray(this.values,4*t),this.quat2.fromArray(this.values,4*(t+1)),THREE.Quaternion.slerp(this.quat1,this.quat2,this.quat3,(e-r)/(i-r))):(this.vec3.fromArray(this.values,3*t),this.vec2.fromArray(this.values,3*(t+1)),this.vec3.lerp(this.vec2,(e-r)/(i-r))))}this.target&&(this.isRot?this.target.copy(this.quat3):this.target.copy(this.vec3))};var n={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},s={5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture},a={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},o={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},c={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},u={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},h=function(e,t,r){if(!e)return Promise.resolve();var i,n=[];if("[object Array]"===Object.prototype.toString.call(e)){i=[];for(var s=e.length,a=0;a<s;a++){var o=t.call(r||this,e[a],a);o&&(n.push(o),o instanceof Promise?o.then(function(e,t){i[a]=t}.bind(this,c)):i[a]=o)}}else{i={};for(var c in e)if(e.hasOwnProperty(c)){var o=t.call(r||this,e[c],c);o&&(n.push(o),o instanceof Promise?o.then(function(e,t){i[e]=t}.bind(this,c)):i[c]=o)}}return Promise.all(n).then(function(){return i})},p=function(e,t){return"string"!=typeof e||""===e?"":/^https?:\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:(t||"")+e},d=function(e,t){var r={};h(t.attributes,function(e,i){var n=t.parameters[e],s=n.type,a=n.semantic;r[i]={type:s,semantic:a}});var i=t.parameters,n=t.attributes,s={};return h(r,function(e,t){var r=n[t],a=i[r],o=a.semantic;o&&(s[t]=a)}),h(s,function(t,r){var i=t.semantic,n=new RegExp("\\b"+r+"\\b","g");switch(i){case"POSITION":e=e.replace(n,"position");break;case"NORMAL":e=e.replace(n,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":e=e.replace(n,"uv");break;case"WEIGHT":e=e.replace(n,"skinWeight");break;case"JOINT":e=e.replace(n,"skinIndex")}}),e},f=function(e){this.isDeferredShaderMaterial=!0,this.params=e};f.prototype.create=function(){var e=THREE.UniformsUtils.clone(this.params.uniforms);return h(this.params.uniforms,function(t,r){t.value instanceof THREE.Texture&&(e[r].value=t.value,e[r].value.needsUpdate=!0),e[r].semantic=t.semantic,e[r].node=t.node}),this.params.uniforms=e,new THREE.RawShaderMaterial(this.params)};var l=function(t,r){this.json=t||{},this.options=r||{},this.cache=new e};l.prototype._withDependencies=function(e){for(var t={},r=0;r<e.length;r++){var i=e[r],n="load"+i.charAt(0).toUpperCase()+i.slice(1),s=this.cache.get(i);if(void 0!==s)t[i]=s;else if(this[n]){var a=this[n]();this.cache.add(i,a),t[i]=a}}return h(t,function(e,t){return e})},l.prototype.parse=function(e){this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then(function(t){var r=t.scenes[this.json.scene],i=[];h(t.cameras,function(e){i.push(e)});var n=[];h(t.animations,function(e){n.push(e)}),e(r,i,n)}.bind(this))},l.prototype.loadShaders=function(){return h(this.json.shaders,function(e,t){return new Promise(function(t){var r=new THREE.XHRLoader;r.responseType="text",r.load(p(e.uri,this.options.path),function(e){t(e)})}.bind(this))}.bind(this))},l.prototype.loadBuffers=function(){return h(this.json.buffers,function(e,t){if("arraybuffer"===e.type)return new Promise(function(t){var r=new THREE.XHRLoader;r.responseType="arraybuffer",r.load(p(e.uri,this.options.path),function(e){t(e)})}.bind(this))}.bind(this))},l.prototype.loadBufferViews=function(){return this._withDependencies(["buffers"]).then(function(e){return h(this.json.bufferViews,function(t,r){var i=e.buffers[t.buffer];return i.slice(t.byteOffset,t.byteOffset+t.byteLength)})}.bind(this))},l.prototype.loadAccessors=function(){return this._withDependencies(["bufferViews"]).then(function(e){return h(this.json.accessors,function(t,r){var i=e.bufferViews[t.bufferView],n=u[t.type],s=a[t.componentType],o=new s(i,t.byteOffset,t.count*n);return new THREE.BufferAttribute(o,n)})}.bind(this))},l.prototype.loadTextures=function(){return h(this.json.textures,function(e,t){if(e.source)return new Promise(function(t){var r=this.json.images[e.source],i=THREE.Loader.Handlers.get(r.uri);null===i&&(i=new THREE.TextureLoader),i.crossOrigin=this.options.crossOrigin||!1,i.load(p(r.uri,this.options.path),function(r){if(r.flipY=!1,e.sampler){var i=this.json.samplers[e.sampler];r.magFilter=o[i.magFilter],r.minFilter=o[i.minFilter],r.wrapS=c[i.wrapS],r.wrapT=c[i.wrapT]}t(r)}.bind(this))}.bind(this))}.bind(this))},l.prototype.loadMaterials=function(){return this._withDependencies(["shaders","textures"]).then(function(e){return h(this.json.materials,function(t,r){var i,a,o={},c={};if(t.extensions&&t.extensions.KHR_materials_common?a=t.extensions.KHR_materials_common:this.json.extensions&&this.json.extensions.KHR_materials_common&&(a=this.json.extensions.KHR_materials_common),a){switch(a.technique){case"BLINN":case"PHONG":i=THREE.MeshPhongMaterial;break;case"LAMBERT":i=THREE.MeshLambertMaterial;break;case"CONSTANT":default:i=THREE.MeshBasicMaterial}h(a.values,function(e,t){o[t]=e}),(a.doubleSided||o.doubleSided)&&(c.side=THREE.DoubleSide),(a.transparent||o.transparent)&&(c.transparent=!0,c.opacity=void 0!==o.transparency?o.transparency:1)}else if(void 0===t.technique)i=THREE.MeshPhongMaterial,h(t.values,function(e,t){o[t]=e});else{i=f;var u=this.json.techniques[t.technique];c.uniforms={};var p=this.json.programs[u.program];if(p){c.fragmentShader=e.shaders[p.fragmentShader],c.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",p.fragmentShader),i=THREE.MeshPhongMaterial);var l=e.shaders[p.vertexShader];l||(console.warn("ERROR: Missing vertex shader definition:",p.vertexShader),i=THREE.MeshPhongMaterial),c.vertexShader=d(l,u);var m=u.uniforms;h(m,function(r,i){var a=u.parameters[r],o=a.type;if(!s[o])throw new Error("Unknown shader uniform param type: "+o);var h=a.count,p=t.values[r],d=new s[o],f=a.semantic,l=a.node;switch(o){case n.FLOAT:d=a.value,"transparency"==r&&(c.transparent=!0),p&&(d=p);break;case n.FLOAT_VEC2:case n.FLOAT_VEC3:case n.FLOAT_VEC4:case n.FLOAT_MAT3:a&&a.value&&d.fromArray(a.value),p&&d.fromArray(p);break;case n.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case n.FLOAT_MAT4:if(h){d=new Array(h);for(var m=0;m<h;m++)d[m]=new s[o];if(a&&a.value){var E=a.value;d.fromArray(E)}p&&d.fromArray(p)}else{if(a&&a.value){var v=a.value;d.fromArray(v)}p&&d.fromArray(p)}break;case n.SAMPLER_2D:d=p?e.textures[p]:null}c.uniforms[i]={value:d,semantic:f,node:l}})}}Array.isArray(o.diffuse)?c.color=(new THREE.Color).fromArray(o.diffuse):"string"==typeof o.diffuse&&(c.map=e.textures[o.diffuse]),delete c.diffuse,"string"==typeof o.reflective&&(c.envMap=e.textures[o.reflective]),"string"==typeof o.bump&&(c.bumpMap=e.textures[o.bump]),Array.isArray(o.emission)&&(c.emissive=(new THREE.Color).fromArray(o.emission)),Array.isArray(o.specular)&&(c.specular=(new THREE.Color).fromArray(o.specular)),void 0!==o.shininess&&(c.shininess=o.shininess);var E=new i(c);return E.name=t.name,E}.bind(this))}.bind(this))},l.prototype.loadMeshes=function(){return this._withDependencies(["accessors","materials"]).then(function(e){return h(this.json.meshes,function(t,r){var i=new THREE.Object3D;i.name=t.name;var s=t.primitives;return h(s,function(t){if(t.mode===n.TRIANGLES||void 0===t.mode){var r=new THREE.BufferGeometry,s=t.attributes;if(h(s,function(t,i){if(t){var n=e.accessors[t];switch(i){case"POSITION":r.addAttribute("position",n);break;case"NORMAL":r.addAttribute("normal",n);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":r.addAttribute("uv",n);break;case"WEIGHT":r.addAttribute("skinWeight",n);break;case"JOINT":r.addAttribute("skinIndex",n)}}}),t.indices){var a=e.accessors[t.indices];r.setIndex(a);var o={start:0,index:0,count:a.count};r.groups.push(o),r.computeBoundingSphere()}var c=e.materials[t.material],u=new THREE.Mesh(r,c);u.castShadow=!0,i.add(u)}else console.warn("Non-triangular primitives are not supported")}),i})}.bind(this))},l.prototype.loadCameras=function(){return h(this.json.cameras,function(e,t){if("perspective"==e.type&&e.perspective){var r=e.perspective.yfov,i=e.perspective.xfov,n=e.perspective.aspect_ratio||1;i=void 0===i&&r?r*n:i;var s=new THREE.PerspectiveCamera(THREE.Math.radToDeg(i),n,e.perspective.znear||1,e.perspective.zfar||2e6);return s.name=e.name,s}if("orthographic"==e.type&&e.orthographic){var s=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,e.orthographic.znear,e.orthographic.zfar);return s.name=e.name,s}}.bind(this))},l.prototype.loadSkins=function(){return this._withDependencies(["accessors"]).then(function(e){return h(this.json.skins,function(t,r){var i={bindShapeMatrix:(new THREE.Matrix4).fromArray(t.bindShapeMatrix),jointNames:t.jointNames,inverseBindMatrices:e.accessors[t.inverseBindMatrices]};return i})}.bind(this))},l.prototype.loadAnimations=function(){return this._withDependencies(["accessors","nodes"]).then(function(e){return h(this.json.animations,function(t,i){var n=[];h(t.channels,function(r){var i=t.samplers[r.sampler];if(i&&t.parameters){var s=r.target,a=s.id,o=t.parameters[i.input],c=t.parameters[i.output],u=e.accessors[o],h=e.accessors[c],p=e.nodes[a];if(p){var d={keys:u.array,values:h.array,count:u.count,target:p,path:s.path,type:i.interpolation};n.push(d)}}});var s=new r(n);return s.name="animation_"+i,s})}.bind(this))},l.prototype.loadNodes=function(){return h(this.json.nodes,function(e,t){var r,i=new THREE.Matrix4;return e.jointName?(r=new THREE.Bone,r.jointName=e.jointName):r=new THREE.Object3D,r.name=e.name,r.matrixAutoUpdate=!1,void 0!==e.matrix?(i.fromArray(e.matrix),r.applyMatrix(i)):(void 0!==e.translation&&r.position.fromArray(e.translation),void 0!==e.rotation&&r.quaternion.fromArray(e.rotation),void 0!==e.scale&&r.scale.fromArray(e.scale)),r}.bind(this)).then(function(e){return this._withDependencies(["meshes","skins","cameras","extensions"]).then(function(t){return h(e,function(r,i){var n=this.json.nodes[i];if(void 0!==n.meshes&&h(n.meshes,function(i){var s=t.meshes[i];h(s.children,function(i){var s,a=i.material,o=i.geometry;a.isDeferredShaderMaterial?a=s=a.create():s=a,i=new THREE.Mesh(o,s),i.castShadow=!0;var c;if(n.skin&&(c=t.skins[n.skin]),c){var u=o,s=a;s.skinning=!0,i=new THREE.SkinnedMesh(u,s,(!1)),i.castShadow=!0;var p=[],d=[];h(c.jointNames,function(t,r){var n=e[t];if(n){n.skin=i,p.push(n);var s=c.inverseBindMatrices.array,a=(new THREE.Matrix4).fromArray(s,16*r);d.push(a)}else console.warn("WARNING: joint: ''"+t+"' could not be found")}),i.bind(new THREE.Skeleton(p,d,(!1)),c.bindShapeMatrix)}r.add(i)})}),void 0!==n.camera){var s=t.cameras[n.camera];r.add(s)}if(n.extensions&&n.extensions.KHR_materials_common&&n.extensions.KHR_materials_common.light){var a=t.extensions.KHR_materials_common.lights[n.extensions.KHR_materials_common.light];r.add(a)}return r}.bind(this))}.bind(this))}.bind(this))},l.prototype.loadExtensions=function(){return h(this.json.extensions,function(e,t){switch(t){case"KHR_materials_common":var r={lights:{}},i=e.lights;return h(i,function(e,t){var i,n=e[e.type],s=(new THREE.Color).fromArray(n.color);switch(e.type){case"directional":i=new THREE.DirectionalLight(s),i.position.set(0,0,1);break;case"point":i=new THREE.PointLight(s);break;case"spot ":i=new THREE.SpotLight(s),i.position.set(0,0,1);break;case"ambient":i=new THREE.AmbientLight(s)}i&&(r.lights[t]=i)}),r}}.bind(this))},l.prototype.loadScenes=function(){var e=function(t,r,i){var n=i[t];r.add(n);var s=this.json.nodes[t];s.children&&h(s.children,function(t){e(t,n,i)})}.bind(this);return this._withDependencies(["nodes"]).then(function(r){return h(this.json.scenes,function(i,n){var s=new THREE.Scene;return s.name=i.name,h(i.nodes,function(t){e(t,s,r.nodes)}),s.traverse(function(e){if(e.material&&e.material.isRawShaderMaterial){var i=new t(e,r.nodes);THREE.GLTFLoader.Shaders.add(e.uuid,i)}}),s})}.bind(this))}}();
var AFRAMEGLTF;!function(t){"use strict";function e(){function t(){this.model=null,this.loader=new THREE.GLTFLoader}function e(){var t=this,e=this.el,a=this.data.asset,n=this.data.loop,i=this.data.auto;a&&(this.remove(),this.loader.load(a,function(a){if(t.model=a.scene,t.animations=a.animations||{},t.cameras=a.cameras||{},e.setObject3D("mesh",t.model),e.emit("model-loaded",{format:"gltf",model:t.model,animations:t.animations,cameras:t.cameras}),a.animations&&a.animations.length)for(var o=a.animations?a.animations.length:0;o--;){var s=a.animations[o];s.loop=n,i&&s.play()}}))}function a(){this.model&&this.el.removeObject3D("mesh")}return{schema:{asset:{type:"asset"},loop:{"default":!0},auto:{"default":!0}},init:t,update:e,remove:a}}t.Component=e}(AFRAMEGLTF||(AFRAMEGLTF={}));var AFRAMEGLTF;!function(t){"use strict";function e(){function t(){this.sceneEl.addEventListener("camera-ready",function(){n=this.sceneEl.object3D,a=this.sceneEl.camera},!0)}function e(){n&&a&&(THREE.GLTFLoader.Animations.update(),THREE.GLTFLoader.Shaders.update(n,this.mainCamera))}var a=null,n=null;return{init:t,tick:e}}t.System=e}(AFRAMEGLTF||(AFRAMEGLTF={}));var AFRAMEGLTF;!function(t){"use strict";window.AFRAME.registerSystem("gltf-model",t.System()),window.AFRAME.registerComponent("gltf-model",t.Component())}(AFRAMEGLTF||(AFRAMEGLTF={}));